define(["require","exports"],function(a,b){"use strict";var c=function(){function b(){this.$videoPlayers=null,this.videoPlayerSelector=".js-videoplayer:not(.is-event-bound)",this.actionFreeVideoPlayerSelector=".js-videoplayer",this.videoPlayerLaunchSelector=".js-launchvideoplayer",this.videoPlayerInlistSelector=".videoplayer-inlist",this.isShowingVideo="is-showingvideo",this.UIPath=window.uibasepath,this.isInitiatedClass="is-initiated",this.delayBGFixing=500,this.VideoTemplates={kalturainarticle:"Handlebar/videoplayer-kaltura-inarticle.min.js",kalturainlist:"Handlebar/videoplayer-kaltura-inlist.min.js",youtubeinarticle:"Handlebar/videoplayer-youtube-inarticle.min.js",youtubeinlist:"Handlebar/videoplayer-youtube-inlist.min.js"},this.BACKIMAGE_AUTOFIX_REQUIRED=!1;var a=this;a.$videoPlayers=$(a.videoPlayerSelector),a.$videoPlayers.each($.proxy(a.initiatePlayer,a)),a.addHandlebarsHelpers(),a.BACKIMAGE_AUTOFIX_REQUIRED&&a.backImageAutoFix()}return b.prototype.vanishBackGround=function(a){a.css("opacity",0)},b.prototype.ratioFixer=function(a,b,c){var d,e,f=!1,g=a.parent();if(a.css("margin-top","0px"),window.matchMedia("(min-width: 750px)").matches)if(d=a.get(0).clientWidth,e=a.get(0).clientHeight,f=!(d>e),a.data("dimention-potrait",f),f){if(g.css("height",b+"px"),g.css("width","100%"),a.css("width","100%"),a.css("height","auto"),a.height()>b){var h=b,i=a.height(),j=-1*((i-h)/2);a.css("margin-top",j+"px")}}else a.css("height",b+"px"),a.css("width","auto"),g.css("height",b+"px"),g.css("width","auto"),a.width()<c&&(a.css("width",c),a.css("height","auto"),g.css("height",b),g.css("width",c));else g.removeAttr("style"),a.removeAttr("style")},b.prototype.ratioFixerInvoke=function(){var a=this;$(a.actionFreeVideoPlayerSelector+"[data-stretched-image]").length>0&&$(a.actionFreeVideoPlayerSelector).each(function(){if(void 0!==$(this).data("stretched-image")||null!==$(this).data("stretched-image")){var b=$(this).find("picture img").eq(0),c=$(this).height(),d=$(this).width();a.ratioFixer(b,c,d)}})},b.prototype.backImageAutoFix=function(){var a=this;setTimeout(function(){a.ratioFixerInvoke()},a.delayBGFixing),setTimeout(function(){a.ratioFixerInvoke()},2*a.delayBGFixing),setTimeout(function(){a.ratioFixerInvoke()},4*a.delayBGFixing),$(window).resize(function(){a.ratioFixerInvoke()}),$("*").click(function(){a.ratioFixerInvoke()}),$("input[type]").on("keyup",function(){a.ratioFixerInvoke()}),$(this.videoPlayerSelector).each(function(){if(void 0!==$(this).data("stretched-image")||null!==$(this).data("stretched-image")){var b=$(this).find("picture img").eq(0),c=$(this).height(),d=$(this).width();b.on("load",function(b){a.ratioFixer($(b.currentTarget),c,d)})}})},b.prototype.addHandlebarsHelpers=function(){a(["handlebars"],function(a){a.registerHelper("ParseTags",function(b){var c=b.fn(this),d="";if("string"==typeof c&&0!==c.length){var e=c.split(",");e.forEach(function(a){var b=a.split("|");d+='<a href="'+b[0]+'" class="tag">'+b[1]+"</a>"})}return new a.SafeString(d)}),a.registerHelper("if_eq",function(a,b,c){return a===b?c.fn(this):c.inverse(this)})})},b.prototype.addEvents=function(a){var b=this,c=a.find(b.videoPlayerLaunchSelector);c.on("click",$.proxy(b.onLaunchClick,b,a)),a.addClass("is-event-bound")},b.prototype.pushImage=function(a){var b=$(a.find(".videoplayer-launchplayer"));0===b.children("picture").length&&b.append('<picture class="image-normal-50 ratio16-9 vid-thumbnail-not-found"><img src=""/></picture>')},b.prototype.initiatePlayer=function(a,b){var c=this,d=$(b);void 0!==d.data("videodata")&&(c.pushImage(d),c.addEvents(d))},b.prototype.onLaunchClick=function(a,b){b.preventDefault();var c=this;c.createPlayedEmbed(a),"inlist"!==a.data("videodisplaymode")&&c.vanishBackGround($(b.currentTarget).parent().find("picture img"))},b.prototype.createPlayedEmbed=function(b){var c=this,d=b.data("videodisplaymode"),e=(b.data("videoid"),"undefined"!=typeof b.data("videodata")?b.data("videodata"):{}),f=b.data("videoservice"),g=b.data("additionalscript"),h=Math.ceil(1e5*Math.random()),i="string"==typeof d&&0!==d.length?c.UIPath+c.VideoTemplates[f+d]:null;if("inlist"===d&&($(c.videoPlayerInlistSelector).remove(),$("."+c.isShowingVideo).removeClass(c.isShowingVideo),$(window).scrollTop(b.offset().top)),"string"==typeof i&&b.hasClass(c.isShowingVideo)===!1){var j=[i];"kaltura"===f&&"string"==typeof g&&0!==g.length&&(0===g.indexOf("//")&&(g=window.location.protocol+g),j.push(g)),a(j,function(a){if("function"==typeof a){e.UNIQUE_OBJ_ID="videoplayer"+e.EntryId+h.toString();var d=a(e);b.append(d).addClass(c.isShowingVideo),b.find(".js-remove").one("click keydown",$.proxy(function(a){a.removeClass(c.isShowingVideo)},c,b)),$(window).trigger("GenericToggleManager-initialize")}})}},b}(),d=new c;return window.videoplayermanager=c,d});